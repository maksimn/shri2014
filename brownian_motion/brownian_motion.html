<!DOCTYPE html>
<head>
    <title>Brownian motion</title>
    <meta charset="utf-8">
    <style>
        body {
            background: #000;
        }

        h1 {
            color: brown;
        }

        circle {
            fill: #f00;
        }

        svg {
            border: 3px solid #fff;
            padding: 6px;
        }
    </style>
</head>
<body>
    <h1>Brownian Motion Demo</h1>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        var width = 960, height = 500;

        var n = 100;

        var particles = d3.range(n).map(function () {
            return {
                x: Math.random() * width,
                y: Math.random() * height 
            };
        });

        var svg = d3.select("body").append("svg").attr("width", width).attr("height", height);

        var g = svg.selectAll("g").data(particles).enter().append("g");

        var circles = g.append("circle").attr("r", 6.0);

        d3.timer(function () {
            for (var i = 0; i < n; i++) {
                var dx = (Math.random() * 2 - 1)*1.5, dy = (Math.random() * 2 - 1)*1.5;
                var particle = particles[i],
                    x = particle.x += dx,
                    y = particle.y += dy;
                
                // Bounce off the walls. 
                if (x < 0) particle.x = 0;
                if (x > width) particle.x = width;
                if (y < 0) particle.y = 0;
                if (y > height) particle.y = height;
            }
            circles.attr("transform", circleTransform);
        });

        function circleTransform(d) {
            return "translate(" + [ d.x, d.y ] + ")";
        }
    </script>
</body>